<%
fontSizeLimit = function(text, fontSize, maxWidth){
    let totalWidth = 0;
    let str = "";
    for(let char of text){
        // if its space or a number
        if(char === ' ' || /^\d+$/.test(char))
            totalWidth += fontSize * 0.7;
        // if its thin character
        else if(char.toLowerCase() == 'i' || char == 'f' || char == 'l' || char == 'j' || char == 'r' || char == 't' || char == '"' || char == "'" || char == '(' || char == ')' || char == ',' || char == '-' || char == '.')
            totalWidth += fontSize * 0.3;
        // if it's uppercase
        else if(char === char.toUpperCase())
            totalWidth += fontSize * 1.04;
        // all other symbols
        else
            totalWidth += fontSize * 0.8;
        if(totalWidth < maxWidth - 13)
            str += char;
        else
            return str + '...';
    }
    return str;
}
%>

<svg
        width="290"
        height="<%= 466 - 104 %>"
        viewBox="0 0 290 <%= 466 - 104 %>"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        style="transform: scale(1.4) translate(15%, 15%);"
>
    <rect width="200" height="<%= 199 %>" rx="4" fill="#212121" />
    <rect x="178" y="8" width="15" height="13" fill="url(#pattern-logo)" />

    <text
            fill="white"
            xml:space="preserve"
            style="white-space: pre"
            font-size="10"
            letter-spacing="0em"
    >
  <tspan x="6" y="<%= 18.93 %>">Recently Played</tspan>
</text>
    <rect
            x="6"
            y="<%= 27 %>"
            width="188"
            height="37"
            rx="2"
            fill="white"
            fill-opacity="0.11"
    />
    <text
            fill="white"
            xml:space="preserve"
            style="white-space: pre"
            font-size="8"
            letter-spacing="0em"
    >
  <tspan x="43" y="<%= 42.844 %>"><%= fontSizeLimit(recentPlayed[0].name,8,220) %></tspan>
  </text>
    <text
            fill="white"
            fill-opacity="0.66"
            xml:space="preserve"
            style="white-space: pre"
            font-size="7"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 54.258 %>"><%= fontSizeLimit(recentPlayed[0].artist, 7, 220)  %></tspan>
</text>

    <rect x="10" y="<%= 31 %>" width="29" height="29" rx="2" fill="url(#pattern1)" />
    <rect
            x="6"
            y="<%= 69 %>"
            width="188"
            height="37"
            rx="2"
            fill="white"
            fill-opacity="0.11"
    />
    <rect x="10" y="<%= 73 %>" width="29" height="29" rx="2" fill="url(#pattern2)" />
    <text
            fill="white"
            fill-opacity="0.66"
            xml:space="preserve"
            style="white-space: pre"

            font-size="7"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 96.258 %>"><%= fontSizeLimit(recentPlayed[1].artist, 7, 220)  %></tspan>
  </text>
    <text
            fill="white"
            xml:space="preserve"
            style="white-space: pre"

            font-size="8"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 84.844 %>"><%= fontSizeLimit(recentPlayed[1].name,8,220) %></tspan>
  </text>
    <rect
            x="6"
            y="<%= 111 %>"
            width="188"
            height="37"
            rx="2"
            fill="white"
            fill-opacity="0.11"
    />
    <rect x="10" y="<%= 115 %>" width="29" height="29" rx="2" fill="url(#pattern3)" />
    <text
            fill="white"
            fill-opacity="0.66"
            xml:space="preserve"
            style="white-space: pre"

            font-size="7"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 138.258 %>"><%= fontSizeLimit(recentPlayed[2].artist, 7, 220)  %></tspan>
  </text>
    <text
            fill="white"
            xml:space="preserve"
            style="white-space: pre"

            font-size="8"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 126.844 %>"><%= fontSizeLimit(recentPlayed[2].name,8,220) %></tspan>
</text>
    <rect
            x="6"
            y="<%= 153 %>"
            width="188"
            height="37"
            rx="2"
            fill="white"
            fill-opacity="0.11"
    />
    <rect x="10" y="<%= 157 %>" width="29" height="29" rx="2" fill="url(#pattern4)" />
    <text
            fill="white"
            fill-opacity="0.66"
            xml:space="preserve"
            style="white-space: pre"

            font-size="7"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 180.258 %>"><%= fontSizeLimit(recentPlayed[3].artist, 7, 220)  %></tspan>
  </text>
    <text
            fill="white"
            xml:space="preserve"
            style="white-space: pre"

            font-size="8"
            letter-spacing="0em"
    >
    <tspan x="43" y="<%= 168.844 %>"><%= fontSizeLimit(recentPlayed[3].name,8,220) %></tspan>
</text>
    <defs>
        <pattern
                id="pattern0"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image0" transform="scale(0.00166667)" />
        </pattern>
        <pattern
                id="pattern1"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image1" transform="scale(0.00333333)" />
        </pattern>
        <pattern
                id="pattern2"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image2" transform="scale(0.00333333)" />
        </pattern>
        <pattern
                id="pattern3"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image3" transform="scale(0.00333333)" />
        </pattern>
        <pattern
                id="pattern4"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image4" transform="scale(0.00333333)" />
        </pattern>
        <pattern
                id="pattern-logo"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use
                    xlink:href="#image-logo"
                    transform="translate(0 -0.00103455) scale(0.00129639 0.00141336)"
            />
        </pattern>
        <pattern
                id="pattern5"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image5" transform="scale(0.0015625)" />
        </pattern>
        <pattern
                id="pattern6"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use
                    xlink:href="#image6"
                    transform="translate(0 -0.0414552) scale(0.00169205)"
            />
        </pattern>
        <pattern
                id="pattern7"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use
                    xlink:href="#image7"
                    transform="translate(-0.000782473) scale(0.00156495)"
            />
        </pattern>
        <pattern
                id="pattern8"
                patternContentUnits="objectBoundingBox"
                width="1"
                height="1"
        >
            <use xlink:href="#image8" transform="scale(0.003125)" />
        </pattern>
        <image
                id="image1"
                width="300"
                height="300"
                xlink:href="<%= recentPlayed[0].cover %>"
        />
        <image
                id="image2"
                width="300"
                height="300"
                xlink:href="<%= recentPlayed[1].cover %>"
        />
        <image
                id="image3"
                width="300"
                height="300"
                xlink:href="<%= recentPlayed[2].cover %>"
        />
        <image
                id="image4"
                width="300"
                height="300"
                xlink:href="<%= recentPlayed[3].cover %>"
        />
        <image
                id="image-logo"
                width="2362"
                height="709"
                xlink:href="<%= recentPlayed[0].logo %>"
        />
        <style>
            <style type="text/css">
                                  text{
                                      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
                                  }
        </style>
        </style>
    </defs>
</svg>
